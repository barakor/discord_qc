name: sync_db

on:
  push:
    branches:
      - db-data
    paths:
      # - db-data.edn  # Change this to your specific file

jobs:
  sync_file:
    runs-on: ubuntu-latest

    steps:
      # - name: Checkout Source Branch
      #   uses: actions/checkout@v4
      #   with:
      #     ref: db-data
          # fetch-depth: 0

      - name: Get File Content from Source Branch
        id: get_file
        uses: octokit/request-action@v2.x
        with:
          ref: db-data
          path: db-data.edn
          owner: ${{ github.repository_owner }}
          repo: ${{ github.event.repository.name }}
          # mediaType: raw
          route: GET /repos/{owner}/{repo}/contents/{path}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}


      - name: Get File SHA on Target Branch
        id: get_sha
        uses: octokit/request-action@v2.x
        with:
          ref: gh-pages
          path: resources/db-data.edn
          owner: ${{ github.repository_owner }}
          repo: ${{ github.event.repository.name }}
          route: GET /repos/{owner}/{repo}/contents/{path}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    
      - name: echo file content
        id: echo_content
        run: |
          echo "${{ steps.get_file.outputs.data }}"

      - name: Commit Updated File to Target Branch
        uses: octokit/request-action@v2.x
        with:
          branch: gh-pages-2
          path: resources/db-data.edn
          owner: ${{ github.repository_owner }}
          repo: ${{ github.event.repository.name }}
          route: PUT /repos/{owner}/{repo}/contents/{path}
          message: "Sync updated file from db-data"
          content: ${{ fromJson(steps.get_file.outputs.data).content }}
          encoding: base64
          sha: ${{ fromJson(steps.get_sha.outputs.data).sha }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
